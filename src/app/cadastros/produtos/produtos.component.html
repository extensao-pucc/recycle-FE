<div class="d-flex background">
    <div class="center">
      <h2 class="d-flex justify-content-between">Produtos    
          <button class="btn btn-success" *ngIf="!showForm" (click)="showForm = !showForm; loadForm()"><i class="fa fa-plus"></i>Cadastrar</button>
      </h2>

        <!-- Tabela -->
        <div class="table-list">
          <table class="table table-hover" *ngIf="!showForm">
            <thead class="thead-dark">
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Código</th>
                <th scope="col">Descrição</th>
                <th scope="col">Família</th>
                <th scope="col">Fornecedor</th>
                <th scope="col">Qualidade</th>
                <th scope="col">Unidade de medida</th>
                <th scope="col">NCM</th>
                <th scope="col">CSTE</th>
                <th scope="col">CSTS</th>
                <th scope="col">CFOPE</th>
                <th scope="col">CFOPS</th>
                <th scope="col">Preço de compra</th>
                <th scope="col">preço de venda</th>
                <th scope="col">Opções</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of tempItemsList">
                <td>{{ item?.id }}</td>
                <td>{{ item?.codigo }}</td>
                <td>{{ item?.descricao }}</td>
                <td>{{ item?.familia.nome }}</td>
                <td>{{ item?.fornecedor.razao_social_nome }}</td>
                <td>{{ item?.qualidade.nome }}</td>
                <td>{{ item?.unidade_de_medida.sigla }}</td>
                <td>{{ item?.NCM }}</td>
                <td>{{ item?.CSTE }}</td>
                <td>{{ item?.CSTS }}</td>
                <td>{{ item?.CFOPE.codigo }}</td>
                <td>{{ item?.CFOPS.codigo }}</td>
                <td>{{ item?.preco_compra }}</td>
                <td>{{ item?.preco_venda }}</td>
                <td>
                    <button type="button" class="btn btn-info mr-2" (click)="updateItem(item)"><i class="fa fa-edit"></i>Editar</button>
                    <button type="button" class="btn btn-danger" (click)="showModal('Deletar', item)"><i class="fa fa-trash"></i>Remover</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- ========== -->

        <!-- Formulario -->
        <hr>

        <form [formGroup]="itemForm" *ngIf="itemForm && showForm">
          <input formControlName="id" hidden="true">

          <div class="form-row">
            <div class="form-group col-md-2">  
              <label>Código: </label>
              <input class="form-control" type="text" maxlength="100" formControlName="codigo">
              <p class="error-msg" *ngIf="itemForm.controls.codigo.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.codigo.errors.msgErro }}
              </p>
            </div>

            <div class="form-group col-md-10">
              <label>Descrição: </label>
              <input class="form-control" type="text" maxlength="100" formControlName="descricao">
              <p class="error-msg" *ngIf="itemForm.controls.descricao.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.descricao.errors.msgErro }}
              </p>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group col-md-3">
              <label>Preço de compra: </label>
              <input class="form-control" prefix="R$ " mask="separator.2" thousandSeparator="." type="text" maxlength="15" formControlName="preco_compra">
              <p class="error-msg" *ngIf="itemForm.controls.preco_compra.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.preco_compra.errors.msgErro }}
              </p>
            </div>
            
            <div class="form-group col-md-3">
              <label>Preço de venda: </label>
              <input class="form-control" prefix="R$ " mask="separator.2" thousandSeparator="." type="text" maxlength="15" formControlName="preco_venda">
              <p class="error-msg" *ngIf="itemForm.controls.preco_venda.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.preco_venda.errors.msgErro }}
              </p>
            </div>

            <div class="form-group col-md-3">
              <label>Unidade de medida: </label>
              <ng-select *ngIf="unidadesDeMedida" formControlName="unidade_de_medida" name="unidade_de_medida">
                <ng-option *ngFor="let unidade_de_medida of unidadesDeMedida" [value]="unidade_de_medida?.id">{{unidade_de_medida.sigla}} - {{unidade_de_medida.descricao}}</ng-option>
              </ng-select>
              <p class="error-msg" *ngIf="itemForm.controls.unidade_de_medida.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.unidade_de_medida.errors.msgErro }}
              </p>             
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group col-md-3">
              <label>Família: </label>
              <ng-select *ngIf="familias" formControlName="familia" name="familia">
                <ng-option *ngFor="let familia of familias" [value]="familia?.id">{{familia.nome}}</ng-option>
              </ng-select>
              <p class="error-msg" *ngIf="itemForm.controls.familia.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.familia.errors.msgErro }}
              </p> 
            </div>

            <div class="form-group col-md-5">
              <label>Fornecedor: </label>
              <ng-select *ngIf="fornecedores" formControlName="fornecedor" name="fornecedor">
                <ng-option *ngFor="let fornecedor of fornecedores" [value]="fornecedor?.id">{{ fornecedor.razao_social_nome }} - {{fornecedor.CNPJ_CPF}}</ng-option>
              </ng-select>
              <p class="error-msg" *ngIf="itemForm.controls.fornecedor.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.fornecedor.errors.msgErro }}
              </p> 
            </div>  

            <div class="form-group col-md-3">
              <label>Qualidade: </label>
              <ng-select *ngIf="qualidades" formControlName="qualidade" name="qualidade">
                <ng-option *ngFor="let qualidade of qualidades" [value]="qualidade?.id">{{qualidade.nome}}</ng-option>
              </ng-select>
              <p class="error-msg" *ngIf="itemForm.controls.qualidade.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.qualidade.errors.msgErro }}
              </p> 
            </div>  
          </div>  

          <div class="form-row">
            <div class="form-group col-md-2">
              <label>NCM: <i class="fa fa-question-circle" tooltip="Nomenclatura Comum do Mercosul"></i></label>
              <input class="form-control" mask="0000.00.00" type="text" formControlName="NCM" placeholder="EX: 0000.00.00">
              <p class="error-msg" *ngIf="itemForm.controls.NCM.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.NCM.errors.msgErro }}
              </p> 
            </div>

            <div class="form-group col-md-2">
              <label>CSTE: <i class="fa fa-question-circle" tooltip="Código de Situação Tributária (Entrada)"></i></label>
              <input class="form-control" type="text" maxlength="5" formControlName="CSTE" placeholder="EX: 000">
              <p class="error-msg" *ngIf="itemForm.controls.CSTE.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.CSTE.errors.msgErro }}
              </p> 
            </div>

            <div class="form-group col-md-2">
              <label>CSTS: <i class="fa fa-question-circle" tooltip="Código de Situação Tributária (Saida)"></i></label>
              <input class="form-control" type="text" maxlength="5" formControlName="CSTS" placeholder="EX: 000">
              <p class="error-msg" *ngIf="itemForm.controls.CSTS.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.CSTS.errors.msgErro }}
              </p> 
            </div>

            <div class="form-group col-md-3">
              <label>CFOPE: <i class="fa fa-question-circle" tooltip="Código Fiscal de Operações e Prestações (Entrada)"></i></label>
              <ng-select *ngIf="naturezaDasOperacoes" formControlName="CFOPE" name="CFOPE">
                <ng-option *ngFor="let CFOPE of naturezaDasOperacoes" [value]="CFOPE?.id">{{ CFOPE.codigo }} - {{ CFOPE.descricao }}</ng-option>
              </ng-select>
              <p class="error-msg" *ngIf="itemForm.controls.CFOPE.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.CFOPE.errors.msgErro }}
              </p> 
            </div>

            <div class="form-group col-md-3">
              <label>CFOPS: <i class="fa fa-question-circle" tooltip="Código Fiscal de Operações e Prestações (Saida)"></i></label>
              <ng-select *ngIf="naturezaDasOperacoes" formControlName="CFOPS" name="CFOPS">
                <ng-option *ngFor="let CFOPS of naturezaDasOperacoes" [value]="CFOPS?.id">{{ CFOPS.codigo }} - {{ CFOPS.descricao }}</ng-option>
              </ng-select>
              <p class="error-msg" *ngIf="itemForm.controls.CFOPS.errors">
                <i class="fa fa-times"></i> {{ itemForm.controls.CFOPS.errors.msgErro }}
              </p> 
            </div>
          </div>
        
          <div class="row align-items-end">
            <hr>
  
            <div>
              <button class="btn btn-success ml-1 mt-3 pull-right" (click)="showModal('Salvar', '')"><i class="fa fa-save"></i>Salvar</button>
              <button class="btn btn-warning ml-1 mt-3 pull-right" (click)="showModal('Cancelar edição', '')"><i class="fa fa-window-close"></i>Cancelar</button>
              <button class="btn btn-danger ml-1 mt-3 pull-right" *ngIf="itemForm.controls.id.value" (click)="showModal('Deletar', itemForm.controls.id.value)"><i class="fa fa-trash"></i>Remover</button>
            </div>
          </div>
                 
        </form>
        <!-- ========== -->
        
        <!-- Lista sem dados -->
        <div *ngIf="!showForm && !tempItemsList?.length"  class="alert alert-info " role="alert">
          <h4 class="alert-heading ">Opa !</h4>
          <p>Nenhum resultado foi encontrado.</p>
        </div>
        <!-- =============== -->

    </div>
</div>  

<app-yes-no-message [yesNoMessage]="yesNoMessage" *ngIf="showYesNoMessage"></app-yes-no-message>
